<!DOCTYPE html>
<html>
  <head>
    <title>TrafficRadar</title>

    <script src="javascript/jquery-1.10.0.min.js"></script>
  </head>
  <body>
    <h1>TrafficRadar</h1>
    <table id="locations_table">
      <thead>
        <tr>
          <td>Id</td>
          <td>Name</td>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

    <div id="test">

    </div>

    <script>
      $(document).ready(function() {
        $.ajax({
          url: '/locations',
          dataType: 'json',
          success: function (results) {
            var ids = getIds(results);
            getTrafficData(ids);

            createTableRows(results);
          }
        });
      });

      function getIds(results) {
        var ids = [];
        for (var key in results) {
          ids.push(results[key]['id']);
        }
        return ids;
      }

      function createTableRows(results) {
        for (var key in results) {
          var id = results[key]['id'];
          var row = "<tr id='row_" + id + "'><td>" + id + "</td><td>" + results[key]['name'] + "</td></tr>";
          $('#locations_table > tbody:last').append(row);
        }
      }

      function getTrafficData(ids) {
        $.ajax({
          url: '/traffic/' + ids.join(),
          dataType: 'json',
          success: function (results) {
            alert(results[0]['traffic'][0]['timestamp']);
          }
        });
      }
    </script>
  </body>
</html>
